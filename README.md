# TPS.Yakovleva

Это учебный проект: Telegram-бот, который понимает вопросы “по-русски” и отвечает числами из базы данных.

Идея простая:
**сообщение пользователя → GigaChat → SQL → PostgreSQL → ответ в Telegram**

---

## Как это работает
1) Пользователь пишет вопрос в Telegram (например: “Сколько всего видео?”).  
2) Бот отправляет этот текст в **GigaChat**.  
3) Модель возвращает **SQL-запрос** (только `SELECT`).  
4) Бот выполняет SQL в PostgreSQL и возвращает результат.

Файл с логикой NL→SQL: `bot/nl2sql.py`

---

## Самое важное (для проверки)
### 1) Распознавание естественного языка
Сделано через **GigaChat API** (не через регулярки).
То есть бот реально “понимает” текст и сам строит запрос.

### 2) Промпт со схемой БД и правилами подсчёта
Чтобы модель не придумывала поля и считала правильно, я описала:
- таблицы и поля
- связи
- правила метрик (например “прирост за день”)

Это лежит в файле: `bot/schema_prompt.py`

---

## Безопасность
Чтобы модель не могла сломать базу, перед выполнением SQL идёт проверка:
- разрешён только `SELECT`
- запрещены `INSERT/UPDATE/DELETE/DROP/ALTER/...`

Файл: `bot/sql_safety.py`

---

## База данных
Схема БД создаётся при запуске из файла:
- `db/001_init.sql`

---

## Как запустить
1) В корне проекта создай `.env` (пример есть в `.env.example`).  
   В `.env` должны быть:
   - `BOT_TOKEN`
   - параметры базы `DB_*`
   - ключи для GigaChat `GIGACHAT_*`

2) Запуск:
```bash
docker compose up --build